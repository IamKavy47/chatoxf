<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>ChatOXF</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  </head>
  <body>
    <div class="app">
      <!-- LEFT PANEL (Login / Dashboard) -->
      <div class="panel left-panel">
        <!-- REGISTER SCREEN (Styled as "Explore" screen) -->
        <div id="screen-register" class="screen active">
          <div class="mindmate-header">
            <div class="logo-row">
              <i class="ri-chat-3-fill"></i> <span>ChatOXF</span>
            </div>
          </div>

          <div class="hero-text">
            Your space<br />to talk.<br />
            <span class="text-accent">Modern & Minimal.</span>
          </div>

          <div class="feature-cards">
            <div class="feature-card">
              <div class="icon-circle">
                <i class="ri-message-3-line"></i>
              </div>
              <div class="text">
                Fast, private conversations with a clean, modern design
              </div>
            </div>

            <div class="feature-card">
              <div class="icon-circle">
                <i class="ri-robot-2-line"></i>
              </div>
              <div class="text">
                ChatOXF AI is always available when you need extra help
              </div>
            </div>
          </div>

          <!-- Functional Inputs Hidden in a "Sign Up" modal or inline? 
             To keep it simple and matching the image, I'll put them in a bottom sheet style container 
             that mimics the buttons area, or just list them cleanly. 
             The image shows "Login" and "Sign up" buttons. 
             I will make the inputs visible but styled minimally above the buttons. -->

          <div class="auth-form-container">
            <div class="input-group">
              <input
                id="regName"
                type="text"
                placeholder="Full Name"
                class="pill-input"
              />
              <input
                id="regUser"
                type="text"
                placeholder="Username"
                class="pill-input"
              />
              <input
                id="regEmail"
                type="email"
                placeholder="Email"
                class="pill-input"
              />
              <input
                id="regPass"
                type="password"
                placeholder="Password"
                class="pill-input"
              />
            </div>

            <div class="action-buttons">
              <button class="btn pill-btn primary" onclick="onRegister()">
                Sign up
              </button>
              <button class="btn pill-btn secondary" onclick="showLogin()">
                Login
              </button>
            </div>
          </div>
        </div>

        <!-- LOGIN SCREEN -->
        <div id="screen-login" class="screen">
          <div class="mindmate-header">
            <div class="logo-row">
              <i class="ri-chat-3-fill"></i> <span>ChatOXF</span>
            </div>
          </div>

          <div class="hero-text">Welcome<br />back</div>

          <div class="auth-form-container">
            <div class="input-group">
              <input
                id="loginUser"
                type="text"
                placeholder="Username"
                class="pill-input"
              />
              <input
                id="loginPass"
                type="password"
                placeholder="Password"
                class="pill-input"
              />
            </div>

            <div class="action-buttons">
              <button class="btn pill-btn primary" onclick="onLogin()">
                Login
              </button>
              <button class="btn pill-btn secondary" onclick="showRegister()">
                Create account
              </button>
            </div>
          </div>
        </div>

        <!-- LIST SCREEN (Dashboard Style) -->
        <div id="screen-list" class="screen" style="display: none">
          <div class="dashboard-header">
            <div class="greeting">
              <span id="dynamicGreeting">Good morning</span>,<br />
              <span id="meNameDisplay">User</span>

              <div
                id="meUser"
                class="user-handle"
                style="
                  margin-top: 4px;
                  font-size: 14px;
                  color: var(--text-secondary);
                "
              ></div>
            </div>
            <div class="avatar-circle" id="meAvatar" style="cursor: pointer">
              <img
                id="meAvatarImg"
                alt="Profile"
                style="
                  display: none;
                  width: 100%;
                  height: 100%;
                  object-fit: cover;
                  border-radius: 50%;
                "
              />
              <span class="fallback">ME</span>
            </div>
          </div>

          <!-- Updated onclick to open the new search panel -->
          <div class="new-chat-btn" onclick="openSearchPanel()">
            <span>New Chat</span>
            <i class="ri-add-line"></i>
          </div>

          <div class="section-label">
            <span>Chat history</span>
            <i class="ri-arrow-right-line"></i>
          </div>

          <!-- Thread List styled as Cards -->
          <div class="thread-list" id="threadList">
            <!-- Threads will be injected here -->
          </div>

          <!-- Bottom Nav (Visual only) -->
          <div class="bottom-nav">
            <div class="nav-item active">
              <i class="ri-home-5-line"></i><span>Home</span>
            </div>
            <div id="navAI" class="nav-item">
              <i class="ri-robot-2-line"></i>
              <span>AI</span>
            </div>

            <div class="nav-item">
              <i class="ri-history-line"></i><span>History</span>
            </div>
          </div>

          <!-- Added dedicated Search Panel Overlay inside the left panel -->
          <div id="searchPanel" class="search-panel-overlay">
            <div class="search-header">
              <button class="close-search-btn" onclick="closeSearchPanel()">
                <i class="ri-arrow-left-line"></i>
              </button>
              <h2>New Chat</h2>
            </div>

            <div class="input-group" style="margin-bottom: 24px">
              <input
                id="searchInput"
                placeholder="Search users by username..."
                class="pill-input"
                onkeyup="onSearchInput(event)"
              />
            </div>

            <div id="searchResults" class="search-results-container">
              <!-- Results injected here -->
              <div
                style="
                  text-align: center;
                  color: var(--text-secondary);
                  margin-top: 40px;
                "
              >
                <i
                  class="ri-search-2-line"
                  style="font-size: 32px; margin-bottom: 12px; display: block"
                ></i>
                Type a username to find people
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL (Chat Interface) -->
      <div class="panel chat-panel" id="chatPanel">
        <div class="chat-topbar">
          <button class="back-btn" onclick="closeChat()">
            <i class="ri-arrow-left-line"></i>
          </button>
          <!-- <div class="avatar-sm chat-header-avatar">
            <img
              id="chatAvatarImg"
              alt="Chat Avatar"
              style="
                display: none;
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 50%;
              "
            />
            <div id="chatAvatar" class="click-overlay"></div>
          </div> -->
          <div class="chat-info">
            <div class="chat-title" id="chatName">User</div>
            <div id="chatUser" class="sub-text"></div>
          </div>
          <button class="menu-btn" onclick="openChatOptions()">
            <i class="ri-more-fill"></i>
          </button>
        </div>

        <div class="messages-container" id="messages">
          <!-- Messages injected here -->
        </div>

        <div class="chat-input-area">
          <div class="floating-input-bar">
            <input id="msgInput" placeholder="Type your message..." />
            <button class="send-fab" onclick="onSend()">
              <i class="ri-send-plane-fill"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals (Profile, OTP, PFP) - Keeping structure but restyling -->
    <div id="pfpModalOverlay" class="modal-overlay">
      <div class="modal card-modal">
        <h3>Upload photo</h3>
        <div class="modal-body">
          <!-- Added proper container with overflow hidden for image preview -->
          <div class="avatar-preview-container">
            <div class="avatar-preview" id="pfpPreviewWrap">
              <img
                id="pfpPreviewImg"
                alt="Profile Preview"
                style="display: none"
              />
            </div>
          </div>
          <input
            type="range"
            id="pfpZoom"
            min="0.5"
            max="3"
            step="0.1"
            value="1"
            class="zoom-slider"
          />

          <input id="pfpFile" type="file" accept="image/*" class="hidden" />
          <label for="pfpFile" class="btn pill-btn secondary"
            >Choose Image</label
          >
          <div class="row-btns">
            <button class="btn text-btn" onclick="skipPfp()">Skip</button>
            <button class="btn pill-btn primary" onclick="savePfp()">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="otpModalOverlay" class="modal-overlay">
      <div class="modal card-modal otp-modal">
        <h3>Verification</h3>
        <p class="otp-subtitle">
          Code sent to <span id="otpEmailDisplay"></span>
        </p>
        <!-- Added data-index attributes for auto-focus logic -->
        <div class="otp-inputs">
          <input class="otp-input" maxlength="1" data-index="0" />
          <input class="otp-input" maxlength="1" data-index="1" />
          <input class="otp-input" maxlength="1" data-index="2" />
          <input class="otp-input" maxlength="1" data-index="3" />
          <input class="otp-input" maxlength="1" data-index="4" />
          <input class="otp-input" maxlength="1" data-index="5" />
        </div>
        <div id="otpTimer" class="timer-text"></div>
        <button id="otpResendBtn" class="btn text-btn resend-btn" disabled>
          Resend Code
        </button>

        <div class="otp-actions">
          <button class="btn pill-btn primary" onclick="verifyOtp()">
            Verify
          </button>
          <button class="btn text-btn" onclick="closeOtpModal()">Cancel</button>
        </div>
      </div>
    </div>

    <div id="profileScreen" class="screen profile-screen">
      <div class="profile-topbar">
        <button class="back-btn" onclick="closeProfileScreen()">
          <i class="ri-arrow-left-line"></i>
        </button>
        <div class="profile-title">Profile</div>
        <div style="width: 40px"></div>
      </div>

      <div class="profile-content">
        <!-- Avatar -->
        <div class="avatar-wrapper">
          <img id="profileAvatarImg" class="profile-avatar" />
          <label id="avatarEditBtn" for="editPfpFile" class="avatar-edit-btn">
            <i class="ri-pencil-fill"></i>
          </label>

          <input type="file" id="editPfpFile" accept="image/*" />
        </div>

        <!-- Name -->
        <label class="field-label">Name</label>
        <input id="editName" class="profile-field" placeholder="Your name" />

        <!-- Username -->
        <label class="field-label">Username</label>
        <input
          id="editUsername"
          class="profile-field"
          placeholder="@username"
        />

        <div id="usernameStatus" class="username-status"></div>

        <!-- Bio -->
        <label class="field-label">Bio</label>
        <textarea
          id="editAbout"
          class="profile-bio"
          placeholder="Write something about yourself..."
        ></textarea>

        <button
          id="btnSaveProfile"
          class="btn-save-profile"
          onclick="saveProfile()"
        >
          Save Changes
        </button>

        <button
          id="btnRemovePfp"
          class="btn-remove-pfp danger"
          onclick="onRemovePfp()"
        >
          Remove Profile Picture
        </button>
      </div>
    </div>

    <!-- MESSAGE ACTION MENU -->
    <div id="msgActionsMenu" class="msg-action-modal">
      <div class="msg-action-sheet">
        <div class="emoji-row">
          <span onclick="reactMessage('‚ù§Ô∏è')">‚ù§Ô∏è</span>
          <span onclick="reactMessage('üòÇ')">üòÇ</span>
          <span onclick="reactMessage('üëç')">üëç</span>
          <span onclick="reactMessage('üî•')">üî•</span>
          <span onclick="reactMessage('üòÆ')">üòÆ</span>
        </div>

        <div class="sheet-btn" onclick="replyToMessage()">Reply</div>
        <div class="sheet-btn danger" onclick="deleteSingleMessage()">
          Delete Message
        </div>
        <div class="sheet-btn cancel" onclick="closeMsgMenu()">Cancel</div>
      </div>
    </div>

    <div
      id="reactionInfoModal"
      class="reaction-info-modal"
      style="display: none"
    >
      <div class="rim-box">
        <div class="rim-header">
          <span id="rimEmoji" style="font-size: 26px"></span>
          <button onclick="closeReactionInfo()" class="close-btn">‚úï</button>
        </div>

        <div id="rimList" class="rim-list"></div>
      </div>
    </div>

    <script src="https://unpkg.com/convex@1.3.1/dist/browser.bundle.js"></script>
    <script src="script.js"></script>
    <script src="animations.js"></script>
    <script src="index.js"></script>
  </body>
</html>
